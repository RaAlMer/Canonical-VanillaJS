{"version":3,"file":"latest-news.js","sources":["../src/index.js"],"sourcesContent":["function revealSection() {\n  var latestNewsSection = document.querySelector(\"[data-js='latest-news']\");\n\n  if (latestNewsSection) {\n    latestNewsSection.classList.remove(\"u-hide\");\n  }\n}\n\nfunction formatDate(date) {\n  var parsedDate = new Date(date);\n  var monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n  return parsedDate.getDate() + \" \" + monthNames[parsedDate.getMonth()] + \" \" + parsedDate.getFullYear();\n}\n\nfunction articleDiv(article, articleTemplateSelector, options) {\n  var articleFragment = getTemplate(articleTemplateSelector);\n  var time = articleFragment.querySelector(\".article-time\");\n  var link = articleFragment.querySelector(\".article-link\");\n  var title = articleFragment.querySelector(\".article-title\");\n  var image = articleFragment.querySelector(\".article-image\");\n  var author = articleFragment.querySelector(\".article-author\");\n  var excerpt = articleFragment.querySelector(\".article-excerpt\");\n  var url = \"\";\n  var imageLink = document.createElement(\"a\");\n\n  if (options.hostname) {\n    url = \"https://\" + options.hostname;\n  }\n\n  var articleImage;\n\n  if (article._embedded && article._embedded[\"wp:featuredmedia\"] && article._embedded[\"wp:featuredmedia\"][0] && article._embedded[\"wp:featuredmedia\"][0].media_details && article._embedded[\"wp:featuredmedia\"][0].media_details.width && article._embedded[\"wp:featuredmedia\"][0].media_details.height) {\n    var media = article._embedded[\"wp:featuredmedia\"][0];\n    articleImage = {\n      url: media.source_url,\n      alt: media.alt_text,\n      width: media.media_details.width,\n      height: media.media_details.height\n    };\n  }\n\n  if (author) {\n    author.innerHTML = article.author.name;\n  }\n\n  if (excerpt) {\n    excerpt.innerHTML = article.excerpt.rendered;\n  }\n\n  if (time) {\n    time.setAttribute(\"datetime\", article.date);\n    time.innerText = formatDate(article.date);\n  }\n\n  if (link) {\n    link.href = url + \"/blog/\" + article.slug;\n\n    if (options.gtmEventLabel) {\n      link.onclick = function () {\n        dataLayer.push({\n          event: \"GAEvent\",\n          eventCategory: \"blog\",\n          eventAction: options.gtmEventLabel + \" news link\",\n          eventLabel: article.slug\n        });\n      };\n    }\n  }\n\n  if (title) {\n    title.innerHTML = article.title.rendered;\n  }\n\n  if (image && articleImage && options.linkImage) {\n    imageLink.href = url + \"/blog/\" + article.slug;\n    image.appendChild(imageLink);\n  }\n\n  if (image && articleImage) {\n    var img = document.createElement(\"img\");\n    img.setAttribute(\"src\", articleImage.url);\n    img.setAttribute(\"alt\", articleImage.alt);\n    img.setAttribute(\"width\", articleImage.width);\n    img.setAttribute(\"height\", articleImage.height);\n\n    if (options.linkImage) {\n      imageLink.appendChild(img);\n    } else {\n      image.appendChild(img);\n    }\n  }\n\n  return articleFragment;\n}\n\nfunction getTemplate(selector) {\n  var template = document.querySelector(selector);\n  var fragment;\n\n  if (\"content\" in template) {\n    fragment = document.importNode(template.content, true);\n  } else {\n    fragment = document.createDocumentFragment();\n\n    for (var i = 0; i < template.childNodes.length; i++) {\n      fragment.appendChild(template.childNodes[i].cloneNode(true));\n    }\n  }\n\n  return fragment;\n}\n\nfunction latestArticlesCallback(options) {\n  return function (event) {\n    var articlesContainer = document.querySelector(options.articlesContainerSelector);\n\n    if (articlesContainer) {\n      while (articlesContainer.hasChildNodes()) {\n        articlesContainer.removeChild(articlesContainer.lastChild);\n      }\n\n      var data = JSON.parse(event.target.responseText);\n\n      if (\"spotlightContainerSelector\" in options) {\n        var spotlightContainer = document.querySelector(options.spotlightContainerSelector);\n\n        if (spotlightContainer) {\n          var latestPinned = data.latest_pinned_articles[0];\n\n          if (latestPinned) {\n            spotlightContainer.appendChild(articleDiv(latestPinned, options.spotlightTemplateSelector, options));\n          }\n        } else {\n          console.warn(\"latest-news: No spotlight container found\");\n        }\n      }\n\n      if (data.latest_articles) {\n        data.latest_articles.forEach(function (article) {\n          articlesContainer.appendChild(articleDiv(article, options.articleTemplateSelector, options));\n        });\n      }\n    } else {\n      console.warn(\"latest-news: No articles container found\");\n    }\n  };\n}\n\nfunction fetchLatestNews(options) {\n  var url = \"https://ubuntu.com/blog/latest-news\";\n  var params = [];\n  revealSection();\n\n  if (options.limit) {\n    params.push(\"limit=\" + options.limit);\n  }\n\n  if (options.tagId) {\n    params.push(\"tag-id=\" + options.tagId);\n  }\n\n  if (options.groupId) {\n    params.push(\"group-id=\" + options.groupId);\n  }\n\n  if (params.length) {\n    url += \"?\" + params.join(\"&\");\n  }\n\n  var oReq = new XMLHttpRequest();\n  oReq.addEventListener(\"load\", latestArticlesCallback(options));\n  oReq.open(\"GET\", url);\n  oReq.send();\n}\n\nif (typeof window.fetchLatestNews == \"undefined\") {\n  window.fetchLatestNews = fetchLatestNews;\n}\n\nexport { articleDiv, fetchLatestNews, formatDate, getTemplate, latestArticlesCallback, revealSection };\n//# sourceMappingURL=index.js.map\n"],"names":["revealSection","latestNewsSection","document","formatDate","date","parsedDate","Date","getFullYear","articleDiv","article","articleTemplateSelector","options","media","articleImage","img","articleFragment","getTemplate","time","link","title","image","author","excerpt","url","imageLink","hostname","height","source_url","alt","alt_text","width","gtmEventLabel","dataLayer","event","eventCategory","eventAction","eventLabel","slug","linkImage","selector","fragment","template","i","length","latestArticlesCallback","articlesContainer","articlesContainerSelector","hasChildNodes","spotlightContainer","latestPinned","data","JSON","responseText","spotlightContainerSelector","spotlightTemplateSelector","console","latest_articles","fetchLatestNews","params","limit","tagId","groupId","oReq","XMLHttpRequest","window"],"mappings":"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"}